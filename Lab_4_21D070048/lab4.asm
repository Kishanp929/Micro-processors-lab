ORG 0H
LJMP MAIN
ORG 100H
MAIN:


ACALL TAKE_INP
ACALL QUANT_ENC
ACALL LED_DISP

HERE:SJMP HERE
ORG 130H
// *****************


TAKE_INP:
MOV A , #00H 
MOV P1 , #00H
MOV R0 , #04H
MOV R1 , #60H
JUMP1:



ADD A , #10H
MOV P1 ,A
ACALL DELAY
SETB P1.0
SETB P1.1
SETB P1.2
SETB P1.3
MOV C , P1.0
MOV B.4 , C
MOV C , P1.1
MOV B.5 , C
MOV C , P1.2
MOV B.6 , C
MOV C , P1.3
MOV B.7 , C

ADD A , #10H
MOV P1 ,  A
ACALL DELAY

SETB P1.0
SETB P1.1
SETB P1.2
SETB P1.3

MOV C , P1.0
MOV B.0 , C
MOV C , P1.1
MOV B.1 , C
MOV C , P1.2
MOV B.2 , C
MOV C , P1.3
MOV B.3 , C

MOV @R1 ,B
INC R1
DJNZ R0 , JUMP1

RET
QUANT_ENC:
MOV R0 , #60H
MOV R1 , #70H
MOV R2 , #04H
JUMP :
CLR C
MOV A , @R0
SUBB A , #0AH
JC HERE1

MOV A , @R0
SUBB A , #14H
JC HERE2

MOV A , @R0
SUBB A , #1EH
JC HERE3

JNC HERE4

HERE3 :
MOV @R1 , #19H 
JC LOL1
HERE2 :
MOV @R1 , #0FH 
JC LOL2
HERE1 :
MOV @R1 , #05H
JC LOL3

HERE4 :
MOV @R1 , #23H
LOL1 :
LOL2 :
LOL3 :

INC R0
INC R1

DJNZ R2 , JUMP









RET
LED_DISP:

MOV R0 , #70H
MOV R1 , #04H

KUMP:
MOV A , @R0

CJNE A , #05H , DUMP1
CLR P1.4
CLR P1.5
CLR P1.6
CLR P1.7
SETB P1.4
ACALL DELAY5
SJMP KUMP1
DUMP1:

CJNE A , #0FH ,DUMP2
CLR P1.4
CLR P1.5
CLR P1.6
CLR P1.7
SETB P1.5
ACALL DELAY5
SJMP KUMP2
DUMP2:

CJNE A , #19H , DUMP3
CLR P1.4
CLR P1.5
CLR P1.6
CLR P1.7
SETB P1.6
ACALL DELAY5
SJMP KUMP3
DUMP3:

CLR P1.4
CLR P1.5
CLR P1.6
CLR P1.7
SETB P1.7
ACALL DELAY5
KUMP1:
KUMP2:
KUMP3:
INC R0
DJNZ R1 , KUMP
RET


DELAY:
PUSH 00H
MOV R0 , #10
M1: ACALL delay_1s
DJNZ R0 , M1
POP 00H
RET

DELAY5:
PUSH 00H
MOV R0 , #5
MM1: ACALL delay_1s
DJNZ R0 , MM1
POP 00H
RET




delay_1s:
PUSH 00H

MOV R0 , #10
K2:
PUSH 01H
MOV R1 , #100
K1: ACALL delay_1ms
DJNZ R1 , K1
POP 01H
DJNZ R0 , K2
POP 00H
RET


delay_1ms:
push 00h
mov r0, #4
h2: acall delay_250us
djnz r0, h2
pop 00h
ret


delay_250us:
push 00h
mov r0, #247
h1: djnz r0, h1
POP 00h
RET

END
